{"version":3,"file":"useselectcommon.js","sourceRoot":"","sources":["../../../../src/components/inputs/select/useselectcommon.ts"],"names":[],"mappings":"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","sourcesContent":["import {AnyObject} from '../../../hooks/usechangeparamscallback.js';\nimport {SelectItemBase} from './selectitem.js';\nimport {SelectChangeItem, SelectProps} from './selectprops.js';\nimport {mergeProps, useFilter, useFocusRing, useHover} from 'react-aria';\nimport {useDataState} from '../../../hooks/usedatastate.js';\nimport {useCallback, useEffect, useMemo, useRef, useState} from 'react';\nimport {hasItemWithText} from './hasitemwithtext.js';\nimport {SpecialSelectItemKey} from './specialselectitemkey.js';\nimport {safeCall} from '../../../utils/functionhelper.js';\nimport {createFlatSelectItemList} from './createflatselectitemlist.js';\nimport {useResizeObserver} from '@react-aria/utils';\nimport {useFieldHelpText} from '../../../hooks/usefieldhelptext.js';\nimport {useScrollToSelectedOption} from './usescrolltoselectedoption.js';\nimport {isEmptyString} from '../../../utils/objecthelper.js';\nimport {DOMAttributes} from '@react-types/shared';\nimport {useNonModalPopoverInModalFix} from '../../../hooks/usenonmodalpopoverinmodalfix.js';\nimport {useSelectItemHighlight} from './useselectitemhighlight.js';\nimport {useControlledState} from '../../../hooks/usecontrolledstate.js';\n\nexport function useSelectCommon<P extends AnyObject, TItem extends SelectItemBase<TItem>>({\n    allowCreate,\n    changeCallback,\n    changeParams,\n    dataState,\n    expandedKeys,\n    helpText,\n    items,\n    isInvalid,\n    isLoading,\n    onFocusChange,\n    text,\n    value,\n    ...props\n}: SelectProps<P, TItem>) {\n    const triggerContentRef = useRef<HTMLDivElement>(null);\n    const popoverRef = useRef<HTMLDivElement>(null);\n    const listBoxRef = useRef<HTMLDivElement>(null);\n    const {focusProps: baseFocusProps, isFocused, isFocusVisible} = useFocusRing({within: true, isTextInput: false});\n    const focusProps: DOMAttributes = mergeProps(baseFocusProps, {\n        onBlur: () => onFocusChange?.(false),\n        onFocus: () => onFocusChange?.(true)\n    });\n    const {hoverProps, isHovered} = useHover(props);\n    const {hasError, isReadOnly} = useDataState(dataState, isInvalid, props.isReadOnly);\n    const {fieldProps, helpTextProps} = useFieldHelpText({\n        dataState,\n        helpText,\n        isInvalid\n    });\n    const [isOpen, setIsOpen] = useControlledState(false, props.isOpen, props.onOpenChange);\n    const {onHighlightedIndexChange, highlightedIndex, highlightSource} = useSelectItemHighlight();\n    const [dynamicMenuWidth, setDynamicMenuWidth] = useState(0);\n    const [selectedItem, setSelectedItem] = useState<TItem | null>(\n        value && text ? ({value, text} as unknown as TItem) : null\n    );\n    const [inputValue, setInputValue] = useState(text ?? '');\n    const [filteredItems, setFilteredItems] = useState<TItem[] | null>(null);\n    const localFilter = useFilter({sensitivity: 'base'});\n    const itemsToRender = useMemo(() => {\n        const baseItems = (filteredItems ?? items).slice();\n\n        if (allowCreate && inputValue && isOpen && !hasItemWithText(items, inputValue)) {\n            baseItems.push({value: SpecialSelectItemKey.CREATABLE, text: inputValue} as TItem);\n        }\n\n        return baseItems;\n    }, [filteredItems, items, allowCreate, inputValue, isOpen]);\n\n    const updateMenuWidth = () => {\n        const content = triggerContentRef.current;\n\n        if (content) {\n            const {width} = content.getBoundingClientRect();\n\n            if (width !== dynamicMenuWidth) {\n                setDynamicMenuWidth(width);\n            }\n        }\n    };\n\n    const onSelectionChange = (newSelectedItem: TItem | null) => {\n        safeCall(props.onSelectionChange, newSelectedItem ? newSelectedItem.value : null);\n        setSelectedItem(newSelectedItem);\n\n        if (newSelectedItem) {\n            safeCall(changeCallback, {...changeParams, ...newSelectedItem} as P & SelectChangeItem<TItem>);\n        } else {\n            safeCall(changeCallback, {...changeParams, value: null} as P & SelectChangeItem<TItem>);\n        }\n    };\n\n    const flatItems = useMemo(\n        () => createFlatSelectItemList(itemsToRender, false, expandedKeys),\n        [itemsToRender, expandedKeys]\n    );\n\n    const onResize = useCallback(() => {\n        updateMenuWidth();\n    }, [triggerContentRef]);\n\n    useResizeObserver({ref: triggerContentRef, onResize});\n\n    useScrollToSelectedOption({isLoading, isOpen, menuRef: listBoxRef});\n\n    useNonModalPopoverInModalFix(isOpen, triggerContentRef, popoverRef);\n\n    useEffect(() => {\n        if (selectedItem?.value !== (value ?? undefined) || selectedItem?.text !== text) {\n            setSelectedItem(value && text ? ({value, text} as unknown as TItem) : null);\n        }\n        setInputValue(text ?? '');\n    }, [value, text]);\n\n    let menuWidth = props.menuWidth;\n\n    if (isEmptyString(menuWidth)) {\n        menuWidth = `${dynamicMenuWidth}px`;\n    }\n\n    return {\n        focusProps,\n        isFocused,\n        isFocusVisible,\n        hoverProps,\n        isHovered,\n        hasError,\n        isReadOnly,\n        setIsOpen,\n        isOpen,\n        selectedItem,\n        inputValue,\n        setInputValue,\n        setFilteredItems,\n        popoverRef,\n        listBoxRef,\n        triggerContentRef,\n        localFilter,\n        updateMenuWidth,\n        onSelectionChange,\n        flatItems,\n        menuWidth,\n        itemsToRender,\n        fieldProps,\n        helpTextProps,\n        onHighlightedIndexChange,\n        highlightedIndex,\n        highlightSource\n    };\n}\n"]}