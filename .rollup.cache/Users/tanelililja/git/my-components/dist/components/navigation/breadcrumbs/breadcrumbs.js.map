{"version":3,"file":"breadcrumbs.js","sourceRoot":"","sources":["../../../../src/components/navigation/breadcrumbs/breadcrumbs.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n    Breadcrumb,\n    Breadcrumbs as ReactAriaBreadcrumbs,\n    BreadcrumbsProps as ReactAriaBreadcrumbsProps,\n    Key,\n    Link\n} from 'react-aria-components';\nimport {classNames} from '../../../utils/classnames.js';\nimport {LABEL_SIZE_MD_CSS_CLASS} from '../../text/index.js';\nimport {RefAttributes, useCallback, useImperativeHandle, useMemo, useRef, useState} from 'react';\nimport {Menu} from '../../action/index.js';\nimport {safeCall} from '../../../utils/functionhelper.js';\nimport {useResizeObserver} from '@react-aria/utils';\nimport {Tooltip, TooltipTrigger, TooltipType} from '../../feedback/index.js';\n\nexport interface BreadcrumbItem {\n    id: string;\n    label: string;\n    isDisabled?: boolean;\n}\n\nexport interface BreadcrumbsProps<T extends BreadcrumbItem>\n    extends Omit<ReactAriaBreadcrumbsProps<T>, 'onAction'>,\n        RefAttributes<HTMLOListElement> {\n    items: T[];\n    /**\n     * Handler that is called when a breadcrumb is clicked.\n     */\n    onAction?: (id: string) => void;\n}\n\nconst MAX_VISIBLE_ELEMENTS_COUNT = 5;\nconst MORE_ELEMENT_ID = 'more';\nconst HIDDEN_ELEMENT_CSS_CLASS = 'breadcrumb--hidden';\nconst TRUNCATED_ELEMENT_CSS_CLASS = 'breadcrumb--truncated';\n\nfunction adaptElements<T extends BreadcrumbItem>(wrapperElement: HTMLElement, itemsWithMore: T[]) {\n    const allElements = wrapperElement.children;\n    const allElementsLen = allElements.length;\n    const hiddenItems: T[] = [];\n    // Static elements which should be always visible.\n    let firstElement: HTMLElement | undefined,\n        moreElement: HTMLElement | undefined,\n        currentElement: HTMLElement | undefined;\n\n    // Reveal all elements and find static elements.\n    for (let i = 0; i < allElementsLen; i++) {\n        const el = allElements[i] as HTMLElement;\n\n        el.classList.remove(HIDDEN_ELEMENT_CSS_CLASS, TRUNCATED_ELEMENT_CSS_CLASS);\n\n        if (i === 0) {\n            firstElement = el;\n        }\n        if (el.dataset.id === MORE_ELEMENT_ID) {\n            moreElement = el;\n        }\n        if (el.dataset.current) {\n            currentElement = el;\n        }\n    }\n\n    const wrapperWidth = wrapperElement.offsetWidth;\n    let stopWidth =\n            (firstElement?.offsetWidth ?? 0) + (moreElement?.offsetWidth ?? 0) + (currentElement?.offsetWidth ?? 0),\n        hasVisibleNonStaticElements = false;\n\n    // Hide elements which don't fit the wrapper or exceed max visible elements count.\n    for (let i = 0; i < allElementsLen; i++) {\n        const el = allElements[i] as HTMLElement;\n\n        // Skip static elements\n        if (el === moreElement || el === firstElement || el === currentElement) {\n            continue;\n        }\n\n        const elementWidth = el.offsetWidth;\n        const isWithinMaxVisibleCount =\n            allElementsLen - 1 >= MAX_VISIBLE_ELEMENTS_COUNT ? i < MAX_VISIBLE_ELEMENTS_COUNT - 2 : true;\n\n        if (isWithinMaxVisibleCount && wrapperWidth >= stopWidth + elementWidth) {\n            stopWidth += elementWidth;\n            hasVisibleNonStaticElements = true;\n        } else {\n            el.classList.add(HIDDEN_ELEMENT_CSS_CLASS);\n            hiddenItems.push(itemsWithMore[i]);\n        }\n    }\n\n    if (hiddenItems.length === 0) {\n        // No hidden items --> hide more-element.\n        moreElement?.classList.add(HIDDEN_ELEMENT_CSS_CLASS);\n    }\n\n    if (!hasVisibleNonStaticElements) {\n        // No visible non-static elements --> allow current element to truncate with ellipsis.\n        currentElement?.classList.add(TRUNCATED_ELEMENT_CSS_CLASS);\n    }\n\n    return {\n        hiddenItems,\n        currentElement\n    };\n}\n\nexport function Breadcrumbs<T extends BreadcrumbItem>({className, items, ref, ...props}: BreadcrumbsProps<T>) {\n    const wrapperRef = useRef<HTMLOListElement>(null);\n    const itemsWithMore = useMemo(() => {\n        const arr = items.slice();\n\n        arr.splice(items.length - 1, 0, {id: MORE_ELEMENT_ID, label: '...'} as T);\n\n        return arr;\n    }, [items]);\n    const [hiddenItems, setHiddenItems] = useState<T[]>([]);\n    const [currentHasTooltip, setCurrentHasTooltip] = useState(false);\n\n    useImperativeHandle(ref, () => wrapperRef.current!, []);\n\n    const onAction = (key: Key) => {\n        if (key !== MORE_ELEMENT_ID) {\n            safeCall(props.onAction, key as string);\n        }\n    };\n\n    const onResize = useCallback(() => {\n        const wrapperElement = wrapperRef.current;\n\n        if (wrapperElement) {\n            const {hiddenItems: hiddenItemsArr, currentElement} = adaptElements(wrapperElement, itemsWithMore);\n\n            setHiddenItems(hiddenItemsArr);\n\n            if (currentElement) {\n                const linkElement = currentElement.firstChild as HTMLElement;\n\n                setCurrentHasTooltip(linkElement.offsetWidth < linkElement.scrollWidth);\n            }\n        }\n    }, [wrapperRef, itemsWithMore]);\n\n    useResizeObserver({ref: wrapperRef, onResize});\n\n    return (\n        <ReactAriaBreadcrumbs\n            {...props}\n            className={classNames('breadcrumbs', className)}\n            onAction={onAction}\n            ref={wrapperRef}>\n            {itemsWithMore.map(({id, label, isDisabled}: T, i) => {\n                const hasTooltip = i === itemsWithMore.length - 1 && currentHasTooltip;\n                let link = (\n                    <Link\n                        className={`breadcrumb-link ${LABEL_SIZE_MD_CSS_CLASS}`}\n                        // Link with tooltip should be focusable so cannot disable.\n                        isDisabled={hasTooltip ? false : isDisabled}>\n                        {label}\n                    </Link>\n                );\n\n                if (hasTooltip) {\n                    link = (\n                        <TooltipTrigger>\n                            {link}\n                            <Tooltip type={TooltipType.Plain}>{label}</Tooltip>\n                        </TooltipTrigger>\n                    );\n                }\n\n                if (id === MORE_ELEMENT_ID) {\n                    link = (\n                        <Menu items={hiddenItems.map((item) => ({id: item.id, name: item.label}))} onAction={onAction}>\n                            {link}\n                        </Menu>\n                    );\n                }\n\n                return (\n                    <Breadcrumb className=\"breadcrumb\" data-id={id} id={id} key={id}>\n                        {link}\n                    </Breadcrumb>\n                );\n            })}\n        </ReactAriaBreadcrumbs>\n    );\n}\n"]}